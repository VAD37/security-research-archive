# Core Mechanism Exploit: Provider Offers with Non-Asymmetrical Put/Strike Ratios

## Summary

Providers can unintentionally create offers with disproportionate risk-reward ratios due to non-asymmetrical put/strike configurations. This allows Takers to exploit these offers for unfair gains, resulting in significant financial losses for Providers.

The absence of safeguards or warnings against creating such offers makes this exploit highly likely to occur.
(Official Docs and code document does not mention anything about this risk)

---

## Finding Description

The Provider-Taker mechanism in the Collar protocol is intended to work alongside the Rolls/Loans system. However, the Rolls/Loans system is optional, allowing Takers to directly accept Provider offers without going through extra features built into Rolls/Loans to mitigate risks.

This design enables the creation of "non-asymmetrical offers" that expose Providers to disproportionate financial risks. The imbalance occurs when the put/strike percentages allow Takers to lock smaller amounts of capital while exposing Providers to significantly larger losses.

The issue is apparent in the key formulas that govern this mechanism:

```js
providerLocked = takerLocked * (call - 100%) / (100% - put)
providerGain = takerLocked * (startPrice * priceDeviationPercentage) / (startPrice * 100% - put)
takerGain = -providerGain

// Simplied from the following code:
// https://github.com/CollarNetworks/protocol-core/blob/3eadf114e72ff49b3096c221f0d8d31951a38292/src/CollarTakerNFT.sol#L185-L186
// https://github.com/CollarNetworks/protocol-core/blob/3eadf114e72ff49b3096c221f0d8d31951a38292/src/CollarTakerNFT.sol#L119-L130

```

### Simplified Example  

A 95% put and 120% call configuration demonstrates the risk:

- **Taker locks 100 USDC.**
- **Provider locks 400 USDC.**

Scenario outcomes:

1. **If the price increases by 5%:**  
   - Taker gains 100 USDC.  
   - Provider loses 100 USDC.

2. **If the price increases by 20%:**  
   - Taker gains 400 USDC.  
   - Provider loses 400 USDC (complete loss).

3. **If the price drops by 6%:**  
   - Provider gains 100 USDC.  
   - Taker loses 100 USDC.

From the Provider's perspective, these scenarios show there is no upside to create non-asymmetrical offers.
The risk-reward ratio is heavily skewed in favor of the Taker, making it an exploitable vulnerability.

---

## Impact Explanation

Allowing non-asymmetrical offers:

1. **Exposes Providers to significant losses:** Providers can lose multiple times their locked value, as seen in the 95% put/120% call example.
2. **Undermines market logic:** The imbalance contradicts the principles of **Variable Prepaid Forward Contracts**, where both sides should have balanced risks and rewards.
3. **Reduces system credibility:** Disproportionate payouts discourage Providers from participating, potentially damaging the protocol's adoption and trustworthiness.

---

## Likelihood Explanation

The likelihood of this exploit is high for several reasons:

1. **Lack of documentation:** Official documentation and UI do not warn Providers about the risks of non-asymmetrical offers.
2. **No restrictions:** Providers can create these offers without any validation or safeguards.
3. **Ease of exploitation:** Takers can actively seek out and exploit such offers, especially if Providers lack a deep understanding of the protocol mechanics.

---

## Proof of Concept

A Desmos graph illustrates the risk disparity in non-asymmetrical offers:  
<https://www.desmos.com/calculator/msjnts5qdm>

### Example Configurations

1. **90% put / 110% call:**  
   - Taker locks 100 USDC.  
   - Provider locks 200 USDC.  
   - A 10% price increase results in Taker gaining 100 USDC, and Provider losing 100 USDC.  
   - Balanced risk-reward.

2. **90% put / 120% call:**  
   - Taker locks 100 USDC.  
   - Provider locks 400 USDC.  
   - A 20% price increase results in Taker gaining 400 USDC, and Provider losing 400 USDC.
   - A 5% price drop results in Provider gaining 100 USDC, and Taker losing 100 USDC.
   - A 20% price drop results in Provider gaining 100 USDC, and Taker losing 100 USDC.
   - Disproportionate risk-reward.

---

## Recommendation

There is zero benefit from Provider perspective to open up offer that is not asymmetrical.
Either add a warning on UI how offer show how much user lost or remove the ability to create non-asymmetrical offer.
