# `LiquidityPool` allow phantom permit. Whitelisted member can be forced to invest WETH pool

<https://github.com/code-423n4/2023-09-centrifuge/blob/512e7a71ebd9ae76384f837204216f26380c9f91/src/LiquidityPool.sol#L214-L217>

If Centrifuge allows WETH on mainnet as an investment, whitelisted members (user) might unknowingly invest in WETH pools.

## Impact

Anyone can force a whitelisted member to invest in WETH pools without their approval. No tokens are lost and investment can be cancel, but the member could be in the dark about their investment.

## Proof of Concept

Because WETH have fallback function but not `permit()` function. So any `permit()` call will be forwarded to fallback function and return success call.

So [this function](https://github.com/code-423n4/2023-09-centrifuge/blob/512e7a71ebd9ae76384f837204216f26380c9f91/src/LiquidityPool.sol#L220-L226)

```solidity
    function requestDepositWithPermit(uint256 assets, address owner, uint256 deadline, uint8 v, bytes32 r, bytes32 s)
        public
    {
        ERC20PermitLike(asset).permit(owner, address(investmentManager), assets, deadline, v, r, s);//@ bypassed for WETH
        investmentManager.requestDeposit(assets, owner);
        emit DepositRequested(owner, assets);
    }
```

will act like `requestDeposit()` without modifier `withApproval(owner)`

```solidity
    function requestDeposit(uint256 assets, address owner) public {
        investmentManager.requestDeposit(assets, owner);
        emit DepositRequested(owner, assets);
    }
```

As long as the owner address approve `InvestmentManager` to spend maximum WETH, anyone can execute `requestDeposit` on their behalf without signing any permit, and `InvestmentManager` will simply spend their WETH allowance to invest any Tranche accept WETH as currency.

## Tools Used

Manual. [Phantom explaination](https://media.dedaub.com/phantom-functions-and-the-billion-dollar-no-op-c56f062ae49f)

## Recommended Mitigation Steps

Follow OpenZeppelin [advice here](https://github.com/Amxx/openzeppelin-contracts/blob/487b3f9cdd0561e151d4965ca18590bba907209a/contracts/token/ERC20/extensions/IERC20Permit.sol#L6-L41) and add modifier `withApproval(owner)` to `requestDepositWithPermit()` and `requestRedeemWithPermit()` function too.

Using ERC20SafePermit is overkill. The main purpose of permit is to combine 2 transaction into one. So it always make sense that the only owner should be able to make deposit/redeem transaction.
