# It is possible for Cheater reverse engineer game client. Send `unstake()` faster than game server can update battle result. Missing safety mechanism lock stake while battle is pending.

AI arena is a L2 smart contract that require offchain centralize game server run custom game logic to stimulate battle.
It is missing safety mechanism to lock stake while battle is pending.
User can `unstake()` even when game server run battle stimulation.

While malicious user cannot read pending tractions fast enough.
They can still simulate battle result on their own game client.

If they manage to stimulate battle result faster than game server can update battle result and sending transaction.
They can call `unstake()` to get their stake back before game server can update lost record, prevent them from losing token and points.

## Impact

If user can predict battle result the moment they know their opponents.
They can avoid losing their stake and points.

This can easily be avoided by require user to send transaction request init battle and locked token first before game server can update battle result.

## Proof of Concept

AI Arena game client will likely be Unity Game Engine run C# code.
C# DLL library can easily reverse engineer to show full original source code without comments.

Or game client on Web3 will just be WebGL game run on JavaScript. JavaScript code on browser can be read/tweak by anyone.

In both case, source code can be easily read and modify.
Couple with AI model shared on IPFS network is free for everyone to read and download.

Under assumption that cheater can remake game client code to stimulate battle result as fast as Game Server on linux.

The moment game client receive message of next opponent battle.

While game server slowly simulate battle result, faster modified game client can also simulate battle result.

User can call `unstake()` first, frontrun game server to get their stake back before game server can update lost record.

## Tools Used

<https://github.com/code-423n4/2024-02-ai-arena/blob/f2952187a8afc44ee6adc28769657717b498b7d4/src/RankedBattle.sol#L267-L290>
<https://github.com/code-423n4/2024-02-ai-arena/blob/f2952187a8afc44ee6adc28769657717b498b7d4/src/RankedBattle.sol#L322-L349>

## Recommended Mitigation Steps

Require user to send transaction request a battle first and locked token.
Prevent unstake before game server can update battle result and release locked state for that token.
