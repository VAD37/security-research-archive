# If Admin remove license from active vault. Chance user cannot withdraw asset out of deprecated vault when collateral value drop along

When a vault is deprecated and removed from license list, it is still possible to deposit into deprecated vault.
Withdrawal is not possible without passing collateral check.
Because deprecated vault not included as collateral, user holding all tokens inside deprecated vault cannot withdraw until collateral Ratio rise 150% again by deposit different tokens which they might not have.

## Impact

Under specific circumstance, user cannot withdraw token out of vault while collateral is still valid enough to withdraw.

## Proof of Concept

If user hold all tokens worth 2000$ inside `wstETH` vault and already mint like 1000$ worth DYAD of collateral.

Assume admin want to prevent further DYAD minting from `wstETH` vault. Admin remove `wstETH` vault from `License.sol`.
All tokens inside `wstETH` vault now no longer included as collateral.

As the result, User DNft collateral value now drop to zero.
Withdrawal no longer possible, only `redeemDyad()` function is available for user repay debt.

User now required to return 1000$ DYAD debt to redeem 2000$ worth of `wstETH`.
They might not have 1000$ on hand, and collateral still worth 2000$ but not retrievable.

Basically user tokens is stuck.

## Reference

`VaultManagerV2` use `vaultLicenser` and `keroseneManager` contract to check if a vault should be used as collateral in evaluation.
<https://github.com/code-423n4/2024-04-dyad/blob/49fb7174576e5147dc73d3222d16954aa641a2e0/src/core/VaultManagerV2.sol#L250-L286>
Admin remove license then user collateral value will drop along.

deposit accept any vault from user input
<https://github.com/code-423n4/2024-04-dyad/blob/49fb7174576e5147dc73d3222d16954aa641a2e0/src/core/VaultManagerV2.sol#L118-L131>

withdrawal require collateral value > minted DYAD
<https://github.com/code-423n4/2024-04-dyad/blob/49fb7174576e5147dc73d3222d16954aa641a2e0/src/core/VaultManagerV2.sol#L133-L153>

## Tools Used

## Recommended Mitigation Steps

