# `VaultManagerV2` liquidation ignore Kerosene Vault make liquidation not profitable when non-Kerosene collateral ratio is less than 100%

CollateralRatio = (total nonKerosene Vault value + total Kerosene Vault value) / $DYAD debt

Non-KeroseneVault is accepted for minting DYAD stablecoin with 100% of collateral value.
KeroseneVault cannot used to mint stablecoin but it can be used as buffer collateral, so total collateral is above 150% threshold for loan.

Liquidator can only take all assets from nonKerosene Vault.
So if Kerosene Vault value worth more than 33% of total collateral value, liquidation will not profitable.

## Impact

No one have incentive to liquidate bad vault loan if user deposit lots of Kerosene vault token.

## Proof of Concept

Liquidation check if CollateralRatio is less than 150%.
<https://github.com/code-423n4/2024-04-dyad/blob/49fb7174576e5147dc73d3222d16954aa641a2e0/src/core/VaultManagerV2.sol#L213>

Total collateral value in USD is sum of all vaults value in USD.
<https://github.com/code-423n4/2024-04-dyad/blob/49fb7174576e5147dc73d3222d16954aa641a2e0/src/core/VaultManagerV2.sol#L247>

Because minting DYAD stablecoin only use nonKerosene vault. Allow borrow maximum 100% from nonKerosene collateral.
<https://github.com/code-423n4/2024-04-dyad/blob/49fb7174576e5147dc73d3222d16954aa641a2e0/src/core/VaultManagerV2.sol#L165>
As long as Kerosene vault value include make collateral >= 150%.
<https://github.com/code-423n4/2024-04-dyad/blob/49fb7174576e5147dc73d3222d16954aa641a2e0/src/core/VaultManagerV2.sol#L167>

It also make sense to only give liquidator asset from nonKerosene vault. Because value of some KeroseneVault can be inflated like `BoundedKeroseneVault`.
<https://github.com/code-423n4/2024-04-dyad/blob/49fb7174576e5147dc73d3222d16954aa641a2e0/src/core/VaultManagerV2.sol#L221-L226>

For example, user borrow 1000 DYAD with $1000 WETH as collateral and $600 KEROSENE in KeroseneVault.
WETH price drop. $1000 WETH not only worth $800
Total collateral = $800+ $600 = $1400

Which is less than 1500$ debt.

Liquidator can pay 1000 DYAD to take 800$ WETH from nonKerosene vault.
Which they will not do because it is not profitable.

## Tools Used

## Recommended Mitigation Steps

Consider give keroseneVault assets as well during liquidation calculation.
