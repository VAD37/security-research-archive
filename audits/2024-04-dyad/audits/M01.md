# `VaultmanagerV2` can deposit asset into vault without being included as collateral. Possible liquidation when have enough collateral

`VaultmanagerV2.sol` deposit/withdraw does not check whenever vault been added into `vaults[]`.
`vaults[]` is used to calculate user total collateral before liquidation.

## Impact

It is possible for user to mistakenly deposit assets into different vault but only 1 vault is used as collateral for borrowing DYAD.
Leading to potential case of liquidation while having enough collateral.

## Proof of Concept

Assume a gnosis safe borrowing DYAD on `WETH_vault`. The NFT owner is gnosis safe.
Another user see the position about to be liquidated. So deposit `wstETH` token into `wstETH_Vault`.

Both `WETH_vault` and `wstETH_Vault` are licensed vault use by `VaultManagerV2`, so It should be counted as collateral.

But the dNFT never add `wstETH_Vault` as vault collateral. So this new collateral is never calculated and the position got liquidated.

## Tools Used

<https://github.com/code-423n4/2024-04-dyad/blob/49fb7174576e5147dc73d3222d16954aa641a2e0/src/core/VaultManagerV2.sol#L118-L131>
<https://github.com/code-423n4/2024-04-dyad/blob/49fb7174576e5147dc73d3222d16954aa641a2e0/src/core/VaultManagerV2.sol#L221-L226>

## Recommended Mitigation Steps

Make sure vault is added before allowing deposit.

```solidity
  /// @inheritdoc IVaultManager
  function deposit(
    uint    id,
    address vault,
    uint    amount
  ) 
    external 
      isValidDNft(id)
  {
+++ require( vaults[id].contains(vault) , "vault not added");

    idToBlockOfLastDeposit[id] = block.number;
    Vault _vault = Vault(vault);
    _vault.asset().safeTransferFrom(msg.sender, address(vault), amount);
    _vault.deposit(id, amount);
  }
```
