## Summary

Epoch rewards are distributed based on a fixed 2-second block cadence, which can lead to inconsistent and unfair reward durations on chains like Base due to variable block production and outages.

## Finding Description

Below is a snippet from `DefiAppHomeCenter.sol` that calculates the new epoch parameters:

```solidity
    /// Constants
    uint256 public constant BLOCK_CADENCE = 2; // seconds per block
    uint256 public constant NEXT_EPOCH_BLOCKS_PREFACE = 7 days / BLOCK_CADENCE;
    function initializeNextEpoch() public returns (bool) {//@no clue why this return boolean
        DefiAppHomeCenterStorage storage $ = _getDefiAppHomeCenterStorage();
        if ($.currentEpoch == 0) {//@only admin can init epoch
            require(hasRole(DEFAULT_ADMIN_ROLE, _msgSender()), DefiAppHomeCenter_onlyAdmin());
            $.currentEpoch = _getNextEpoch($);//epoch:1
            _setEpochParams(
                $,
                $.currentEpoch,//1
                block.number + ($.defaultEpochDuration / BLOCK_CADENCE),//endBlock: now + 15 days
                block.timestamp.toUint96(),//startTime
                EpochDistributor.estimateDistributionAmount(
                    $.defaultRps, block.number, block.number + ($.defaultEpochDuration / BLOCK_CADENCE), BLOCK_CADENCE
                ).toUint128(),// = 1e18 * 30 days
                uint8(EpochStates.Ongoing)
            );//@audit-ok M epoch based on block.number counting is unrealiable. Use timestamp is better. It have multiple drawback. Most severe is not guanrantee epoch duration is correct.
            return true;
        }
        if (block.number >= ($.epochs[$.currentEpoch].endBlock - NEXT_EPOCH_BLOCKS_PREFACE)) {//@end - 3.5 days
            EpochParams memory previous = $.epochs[$.currentEpoch];
            uint8 stateToSet = block.number > previous.endBlock 
                ? uint8(EpochStates.Ongoing)//@set nextEpoch to ongoing. same as init above
                : $.votingActive == 1 ? uint8(EpochStates.Voting) : uint8(EpochStates.Initialized);// trigger update epoch before end in ~3 days.
            $.currentEpoch = _getNextEpoch($);//@if update epoch early. It set to voting/initalized for 3.5 days. while previous epoch still ongoing.
            uint256 nextEndBlock = previous.endBlock + ($.defaultEpochDuration / BLOCK_CADENCE);//@nextEpoch = endBlockNumber + 15 days
            uint96 nextEstimatedStartTimestamp = //@ = endBlockNumber + 15 days - block.number * 2 + now = left over epoch time + 15 days + now
                ((nextEndBlock - block.number) * BLOCK_CADENCE + block.timestamp).toUint96();
            _setEpochParams(
                $,
                $.currentEpoch,
                nextEndBlock,
                nextEstimatedStartTimestamp,
                EpochDistributor.estimateDistributionAmount(
                    $.defaultRps, previous.endBlock, nextEndBlock, BLOCK_CADENCE //@distribution same as init = 30 days * 1e18
                ).toUint128(),
                stateToSet
            );
            return true;
        } else {
            return false;
        }
    }
```

Based on the above code and context, the default epoch duration is 15 days. When the previous epoch nears its end, anyone can trigger the next epoch, which is set to 15 days from the last epoch's end.
The code checks if `block.number` is greater than or equal to the current epoch’s end block—calculated using a fixed `BLOCK_CADENCE` of 2 seconds.

However, this assumption does not hold true consistently, resulting in epoch durations that deviate from the intended period.

### L2 Base/OP chain issue

According to the BedRock documentation, the chain may experience outages or downtime. Due to centralization, the chain might halt block production and queue transactions in a mailbox, resuming them only when the chain comes back online. 

Although the Base chain has cosistently produced blocks  exact every  2 seconds, it is built on the Optimism stack, which relies on EVM upgrades and whose consensus mechanism may change block production timing.

Historical data from Optimism shows that over a 700-day period—assuming a 2-second block cadence—the chain produced blocks corresponding to only about 670 days, clearly demonstrating inconsistent block production.

## Impact Explanation

Medium: The reliance on a fixed block cadence can lead to unpredictable reward distribution times, causing some epochs to extend longer than intended and affecting users’ ability to claim rewards fairly.

## Likelihood Explanation

Medium: Optimism L2 chain already failed to produce 2 seconds block before. It is unclear base chain build on top of optimism tech stack would also produce same result.

## Proof of Concept

Assume a block time of 2 seconds and an epoch duration of 7 days:

- Starting from block number 131482800
    (<https://optimistic.etherscan.io/block/131482800>),
- Rewinding 21 days (3 epochs) yields block 130572800
    (<https://optimistic.etherscan.io/block/129665600>), where the epoch duration remains unchanged.
- However, rewinding 700 days (approximately 100 epochs) gives block number 101240000
    (<https://optimistic.etherscan.io/block/101240000>), indicating that only 620 days have been accounted for.

Looking at BaseScan always produce 2 second block since its conception. So there is no proof that Base might ever produce 2 seconds block.

## Recommendation

Use a timestamp-based approach for determining epoch boundaries.For examples:

`startEpoch = (block.timestamp / epochDuration * epochDuration) + DELAY_INITIAL_START_TIME`
`currentEpoch = (block.timestamp / epochDuration * epochDuration) - startEpoch`
