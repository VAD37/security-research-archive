# CompoundV3 Connector missing owned rewards during TVL calculation

Based on Comet docs <https://docs.compound.finance/protocol-rewards/>

It is possible to fetch external earned rewards through this function

```solidity
struct RewardOwed {
    address token;
    uint owed;
}

function getRewardOwed(address comet, address account) external returns (RewardOwed memory)
```

## Impact

COMP token rewards normally worth 25% of the interest earned by the user.
So ignore this reward will cause TVL calculation to be inaccurate.

Causing undervalue of user share price during deposit and withdraw until $COMP rewards are claimed.

## Proof of Concept

COMP rewards is calculated using external rewards contract.
To correctly found current owned COMP rewards token holded by all positions.
A function like this need to be called
`IRewards(rewardContract).getRewardOwed(address comet, address account)`

In `CompoundConnector`, there is no function like that.
And TVL only checking earned interest balance of user position and ignoring external rewards.

## Tools Used

<https://github.com/code-423n4/2024-04-noya/blob/9c79b332eff82011dcfa1e8fd51bad805159d758/contracts/connectors/CompoundConnector.sol#L125-L132>

## Recommended Mitigation Steps

Include COMP rewards in TVL calculation

```solidity
    function _getPositionTVL(HoldingPI memory p, address base) public view override returns (uint256) {
        address market = abi.decode(registry.getPositionBP(vaultId, p.positionId).data, (address));

        uint256 positiveBalance = getCollBlanace(IComet(market), false);
        uint256 negativeBalance = getBorrowBalanceInBase(IComet(market));
        uint256 balance = positiveBalance - negativeBalance;
        uint tvl = valueOracle.getValue(IComet(market).baseToken(), base, balance);
        //@audit include COMP rewards in TVL calculation   
        uint reward = IRewards(rewardContract).getRewardOwed(market, address(this)).owed;
        tvl += valueOracle.getValue(COMP_address, base, reward);
        return tvl;
    }
```
