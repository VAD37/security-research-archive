# ERC4626 donation attack still viable by spamming early deposit queue

Spamming 1 wei share deposit queue early during vault deployment give attacker opportunity to control share price.

Because `AccountingManager` Vault Manager run deposit queue one by one, attacker will just have their share token minted first and early supply token was still small.
Allowing attacker to donate token to vault and inflate share price for future user.

Because there is 30 minutes waiting time for deposit.
If any attacker manage to bypass Noya project emergency offchain monitoring, they can easily steal other people deposit funds.
Following standard ERC4626 donation attack.

## Impact

No minimum token deposit allowing spamming 1 wei deposit to initiate ERC4626 donation attack.
Whether attack success or not depend on Vault Manager or keeper offchain monitoring to pause Vault before attacker steal other people deposit.

## Proof of Concept

There is no minimum deposit. Any can deposit 1 wei token.
<https://github.com/code-423n4/2024-04-noya/blob/9c79b332eff82011dcfa1e8fd51bad805159d758/contracts/accountingManager/AccountingManager.sol#L200-L203>

Vault Manager required to mint users share in group. And share price follow standard ERC4626 formular.
<https://github.com/code-423n4/2024-04-noya/blob/9c79b332eff82011dcfa1e8fd51bad805159d758/contracts/accountingManager/AccountingManager.sol#L238>
`share = depositAmount * totalSupply / totalAssets`

Assumming 100 users in queue got deposit at the same times. But all deposit only worth 1 wei.

Share price for all 100 users will be `1 wei token = 1 share`.
While it should be something like `1e18 token = 1e18 share`.

Now by donating token to vault directly, attacker can inflate share price for future user.
Ex, donate 100e18 token to vault. Share price rise to `sharePrice = depositAmount * 100e1 / 100e18 = depositAmount /1e18`. If next user deposit 1e17 token, their minted share will be rounded down to 0.

## Tools Used

## Recommended Mitigation Steps

Introduce minimum deposit unique for each vault will increase slippage attack cost significantly.
Make price slippage attack less viable.
