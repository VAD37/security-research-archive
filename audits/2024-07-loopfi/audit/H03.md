# `CDPVault` did not handle external rewards from `PENDLE-LP`

**PendleLP** tokens (e.g: _0x464F5A15Aca6Fe787Cf54fCF1E8AF6207939d297_, _0xb9e8bb1105382b018c6adfd95fd9272542cc1776_) are `PendleMarketV3` contracts.
All of these token have external rewards, mostly $Pendle token.

Rewards are split evenly between user holding `PENDLE-LP` token.

CDPVault did hold token belong to user, also hold rewards belong to user.

## Impact

If there is any rewarder send PENDLE token to PendleLP contract, `CDPVault` holding LP token belong to user should be able claim rewards belong to user.
Currently, `CDPVault` do not handle this. So any rewards token will simply stuck inside `CDPVault`.

Causing user loss on potential rewards.

## Proof of Concept

_Already test with Foundry fork. Request BackStage proof on demand._

`PendleMarket` check and accrued rewards for all user on each transfer operation.
<https://github.com/pendle-finance/pendle-core-v2-public/blob/e6184df2d37be670bd058651e68bd98e2723411a/contracts/core/Market/PendleMarket.sol#L334-L347>

Rewards are split evenly between all users holding `PendleMarket`/PENDLE-LP token.
<https://github.com/pendle-finance/pendle-core-v2-public/blob/e6184df2d37be670bd058651e68bd98e2723411a/contracts/core/RewardManager/RewardManager.sol#L16-L59>

If any rewarder send PENDLE token to PendleMarket. All user holding Pendle-LP are eligible to receive rewards.

Looking through all `CDPVault` contracts and its dependencies.
`CDPVault` is not designed to handle token that have internal rewards like Pendle-LP

There is no admin control to handle random token.
There is no function to claim accrued rewards before send back to user.

## Tools Used
https://github.com/code-423n4/2024-07-loopfi/blob/57871f64bdea450c1f04c9a53dc1a78223719164/src/CDPVault.sol#L36-L39
## Recommended Mitigation Steps

It look like Pendle reward is received from Gauge controller.
<https://etherscan.io/address/0x47d74516b33ed5d70dde7119a40839f6fcc24e57#readProxyContract>

Because it is unclear when Pendle rewards will be send, the fastest way to handle this admin control swap external rewards to treasury. Then compensate user with higher interest rate for lender.
