# `V2Migrator.sol` have same 1 wei exploit as `ERC4626`. First migrator/user can drain `BathBuddy.sol` rewards token

The `BathBuddy` [reward formula](https://github.com/code-423n4/2023-04-rubicon/blob/1cd6d4e84c510c70c9062e2d6f961502f50aa097/contracts/periphery/BathBuddy.sol#L127-L134) look like this:
```reward = (time - lastTime) *rewardRate* 1e18 / totalSupply```
Or
```reward = fixedRate * timePassed / totalSupply```

`totalSupply` can be manipulated early by Migrator user from V1 to V2.

In case of admin setup `BathHouse`, `BathBuddy` along with all token rewards. But no user migration yet.

The first or early user can abuse this by prove 1 wei to `totalSupply`. Aka, 1 wei of share token from V1 contract.

This broke the reward formula. User reward get multiply by `1e18` per second.

## Impact

First migrator can drain all reward token from `BathBuddy.sol`.

## Proof of Concept

[The reward formula](https://github.com/code-423n4/2023-04-rubicon/blob/1cd6d4e84c510c70c9062e2d6f961502f50aa097/contracts/periphery/BathBuddy.sol#L127-L134) is entirely rely on ERC20 token have 18 decimals and totalSupply > 1e18.

As can see here:

```js
return// reward = (time - lastTime) * rewardRate * 1e18 / totalSupply
    rewardsPerTokensStored[token].add(
        lastTimeRewardApplicable(token)
            .sub(lastUpdateTime[token])
            .mul(rewardRates[token])
            .mul(1e18)
            .div(IERC20(myBathTokenBuddy).totalSupply())//@audit totalSupply is manipulated by migratorV2 user.
    );
```

The reward rate is multiply by `1e18` to offset the `totalSupply` decimals.

If user can manipulate the totalSupply number to make it < 1e18. The rewardRate will be screwed up and give user more rewards than expected.

This can only happen during early migration period. When no user have [call `migrate()` yet.](https://github.com/code-423n4/2023-04-rubicon/blob/1cd6d4e84c510c70c9062e2d6f961502f50aa097/contracts/V2Migrator.sol#L38)

If admin already init rewardToken, rewardRate amount and bathBuddy friendship started.
Abuser can simply mint 1 wei from V1, and migrate this 1 wei to V2.

Call `getReward()` [from BathHouseV2](https://github.com/code-423n4/2023-04-rubicon/blob/1cd6d4e84c510c70c9062e2d6f961502f50aa097/contracts/BathHouseV2.sol#L131-L133) just a few seconds after. Just to enough not to blow pass maximum reward token sinide `BathBuddy.sol` contract.

Claim rewards right after. And get all reward token.

## Tools Used

Manual

## Recommended Mitigation Steps

Make sure user migrate first before admin call `notifyRewardAmount()`. Just so `totalSupply` token amount > 1e18
